<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ordered List Fix Test</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        
        .test-section {
            margin: 30px 0;
            padding: 20px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            background: #f9f9f9;
        }
        
        .test-title {
            color: #9527F5;
            font-weight: 600;
            margin-bottom: 15px;
        }
        
        .before, .after {
            margin: 15px 0;
            padding: 15px;
            border-radius: 5px;
        }
        
        .before {
            background: #ffebee;
            border-left: 4px solid #f44336;
        }
        
        .after {
            background: #e8f5e8;
            border-left: 4px solid #4caf50;
        }
        
        .before-label, .after-label {
            font-weight: 600;
            margin-bottom: 10px;
        }
        
        .before-label {
            color: #d32f2f;
        }
        
        .after-label {
            color: #388e3c;
        }
        
        .debug-info {
            background: #f0f0f0;
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
            margin: 10px 0;
            white-space: pre-wrap;
        }
        
        /* Enhanced list styles */
        ul, ol {
            margin-bottom: 16px;
            padding-left: 24px;
            margin-left: 0;
            margin-top: 8px;
        }
        
        ul {
            list-style-type: disc;
        }
        
        ol {
            list-style-type: decimal;
        }
        
        li {
            margin-bottom: 8px;
            line-height: 1.6;
            padding-left: 4px;
        }
        
        strong {
            font-weight: 600;
        }
        
        h1, h2, h3 {
            color: #9527F5;
            margin-top: 24px;
            margin-bottom: 16px;
            font-weight: 600;
        }
        
        h1 {
            font-size: 32px;
            font-weight: 700;
            border-bottom: 2px solid #e0e0e0;
            padding-bottom: 8px;
        }
        
        h2 {
            font-size: 28px;
            font-weight: 600;
        }
    </style>
</head>
<body>
    <h1>Ordered List Fix Test</h1>
    
    <div class="test-section">
        <div class="test-title">Problem: Ordered Lists Showing as 1. 1. 1. 1.</div>
        
        <div class="debug-info">
<strong>Your API Response:</strong>
Q.1 Which one of the following statements about art best captures the argu-
ments made in the passage?
1. In the age of online subscription services, it is time to change our understanding of
classic works of art being primarily immutable and easily available to the public.
2. Accepting retroactive changes to works of art is dangerous because it will encourage
creators to not put enough effort into the original attempt, given that they can
always edit or update their work later.
3. Works of art belong to the cultural commons and hence must remain available in
perpetuity, irrespective of who pays for access to them.
4. As art is increasingly created, stored, and distributed digitally, access to it is coun-
terintuitively likely to be made more difficult by the rapid churn in technology and
the whims of host platforms.
        </div>
        
        <div class="before">
            <div class="before-label">Before Fix (Broken):</div>
            <ul>
                <li>1. In the age of online subscription services...</li>
                <li>1. Accepting retroactive changes...</li>
                <li>1. Works of art belong to the cultural commons...</li>
                <li>1. As art is increasingly created...</li>
            </ul>
        </div>
        
        <div class="after">
            <div class="after-label">After Fix (Correct):</div>
            <ol>
                <li>In the age of online subscription services, it is time to change our understanding of classic works of art being primarily immutable and easily available to the public.</li>
                <li>Accepting retroactive changes to works of art is dangerous because it will encourage creators to not put enough effort into the original attempt, given that they can always edit or update their work later.</li>
                <li>Works of art belong to the cultural commons and hence must remain available in perpetuity, irrespective of who pays for access to them.</li>
                <li>As art is increasingly created, stored, and distributed digitally, access to it is counterintuitively likely to be made more difficult by the rapid churn in technology and the whims of host platforms.</li>
            </ol>
        </div>
    </div>
    
    <div class="test-section">
        <div class="test-title">Root Cause Analysis</div>
        
        <div class="debug-info">
<strong>The Problem:</strong>
The ordered list detection logic was flawed. It was trying to match processed HTML lines with original markdown lines incorrectly.

<strong>OLD Logic (Broken):</strong>
const isOrderedListItem = /^\s*&lt;li&gt;/.test(line) && i > 0 && /^\s*\d+\./.test(markdown.split('\n')[i]);

<strong>NEW Logic (Fixed):</strong>
const originalLine = originalLines[i] || '';
const isOrderedListItem = isListItem && /^\s*\d+\./.test(originalLine);
        </div>
        
        <div class="after">
            <div class="after-label">Key Improvements:</div>
            <ul>
                <li><strong>Better line matching</strong> - Now properly matches HTML lines with original markdown lines</li>
                <li><strong>Simplified detection</strong> - Direct check for numbered items in original markdown</li>
                <li><strong>Proper list wrapping</strong> - Ordered lists now wrapped in &lt;ol&gt; tags instead of &lt;ul&gt;</li>
                <li><strong>Added debugging</strong> - Console logs to track list type detection</li>
            </ul>
        </div>
    </div>
    
    <div class="test-section">
        <div class="test-title">Test Your Content</div>
        
        <div class="debug-info">
<strong>Expected Behavior:</strong>
- Lines starting with "1." should become &lt;ol&gt; with proper numbering (1, 2, 3, 4)
- Lines starting with "‚óè" should become &lt;ul&gt; with bullet points
- Mixed content should be handled correctly
        </div>
        
        <div class="after">
            <div class="after-label">Debugging Information:</div>
            <ul>
                <li>Open browser console (F12) when uploading PDF</li>
                <li>Look for: <code>[ButtonPanel] Found ordered list items: ["1.", "2.", "3.", "4."]</code></li>
                <li>Look for: <code>[ButtonPanel] Starting list type: ol for line: 1. In the age...</code></li>
                <li>Verify that numbered items show as 1, 2, 3, 4 instead of 1, 1, 1, 1</li>
            </ul>
        </div>
    </div>
    
    <script>
        // Test the ordered list detection
        const testContent = `Q.1 Which one of the following statements about art best captures the argu-
ments made in the passage?
1. In the age of online subscription services, it is time to change our understanding of
classic works of art being primarily immutable and easily available to the public.
2. Accepting retroactive changes to works of art is dangerous because it will encourage
creators to not put enough effort into the original attempt, given that they can
always edit or update their work later.
3. Works of art belong to the cultural commons and hence must remain available in
perpetuity, irrespective of who pays for access to them.
4. As art is increasingly created, stored, and distributed digitally, access to it is coun-
terintuitively likely to be made more difficult by the rapid churn in technology and
the whims of host platforms.`;
        
        console.log('Testing ordered list detection...');
        
        // Test ordered list detection
        const orderedMatches = testContent.match(/^\s*\d+\./gm);
        console.log('Found ordered list items:', orderedMatches);
        
        // Test the processing
        const lines = testContent.split('\n');
        lines.forEach((line, index) => {
            if (/^\s*\d+\./.test(line)) {
                console.log(`Line ${index}: "${line}" - Should be ordered list item`);
            }
        });
    </script>
</body>
</html>
