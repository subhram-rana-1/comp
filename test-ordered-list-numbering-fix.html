<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ordered List Numbering Fix Test</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        
        .test-section {
            margin: 30px 0;
            padding: 20px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            background: #f9f9f9;
        }
        
        .test-title {
            color: #9527F5;
            font-weight: 600;
            margin-bottom: 15px;
        }
        
        .before, .after {
            margin: 15px 0;
            padding: 15px;
            border-radius: 5px;
        }
        
        .before {
            background: #ffebee;
            border-left: 4px solid #f44336;
        }
        
        .after {
            background: #e8f5e8;
            border-left: 4px solid #4caf50;
        }
        
        .before-label, .after-label {
            font-weight: 600;
            margin-bottom: 10px;
        }
        
        .before-label {
            color: #d32f2f;
        }
        
        .after-label {
            color: #388e3c;
        }
        
        .debug-info {
            background: #f0f0f0;
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
            margin: 10px 0;
            white-space: pre-wrap;
        }
        
        /* Enhanced list styles */
        ul, ol {
            margin-bottom: 16px;
            padding-left: 24px;
            margin-left: 0;
            margin-top: 8px;
        }
        
        ul {
            list-style-type: disc;
        }
        
        ol {
            list-style-type: decimal;
        }
        
        li {
            margin-bottom: 8px;
            line-height: 1.6;
            padding-left: 4px;
        }
        
        strong {
            font-weight: 600;
        }
        
        h1, h2, h3 {
            color: #9527F5;
            margin-top: 24px;
            margin-bottom: 16px;
            font-weight: 600;
        }
        
        h1 {
            font-size: 32px;
            font-weight: 700;
            border-bottom: 2px solid #e0e0e0;
            padding-bottom: 8px;
        }
        
        h2 {
            font-size: 28px;
            font-weight: 600;
        }
        
        .question {
            font-weight: 600;
            margin-bottom: 20px;
            color: #333;
        }
        
        .highlight-issue {
            background: #ffebee;
            padding: 2px 4px;
            border-radius: 3px;
            color: #d32f2f;
            font-weight: 600;
        }
        
        .highlight-fix {
            background: #e8f5e8;
            padding: 2px 4px;
            border-radius: 3px;
            color: #388e3c;
            font-weight: 600;
        }
    </style>
</head>
<body>
    <h1>Ordered List Numbering Fix Test</h1>
    
    <div class="test-section">
        <div class="test-title">Issue: All Items Showing "1." Instead of "1. 2. 3. 4."</div>
        
        <div class="debug-info">
<strong>Your API Response:</strong>
Q.2 "Netflix had begun editing old episodes of Stranger Things to retroactively improve their visual effects." What is the purpose of this example used in the passage?
1. To show a practice that justifies the fears of people who feel streaming services cannot be trusted to be custodians of cultural artefacts like film.
1. To show that streaming services are controlling access to the cultural commons rather than expanding it.
1. To show how unsubstantiated reports are leading to an increase in the level of distrust towards streaming services.
1. To show that art in the digital age, specifically film, is no longer sacrosanct, and...
        </div>
        
        <div class="before">
            <div class="before-label">Before Fix (All "1."):</div>
            <div class="question">Q.2 "Netflix had begun editing old episodes of Stranger Things to retroactively improve their visual effects." What is the purpose of this example used in the passage?</div>
            <ol>
                <li><span class="highlight-issue">1. To show a practice that justifies the fears...</span></li>
                <li><span class="highlight-issue">1. To show that streaming services are controlling...</span></li>
                <li><span class="highlight-issue">1. To show how unsubstantiated reports are leading...</span></li>
                <li><span class="highlight-issue">1. To show that art in the digital age...</span></li>
            </ol>
        </div>
        
        <div class="after">
            <div class="after-label">After Fix (Correct Numbering):</div>
            <div class="question">Q.2 "Netflix had begun editing old episodes of Stranger Things to retroactively improve their visual effects." What is the purpose of this example used in the passage?</div>
            <ol>
                <li><span class="highlight-fix">To show a practice that justifies the fears of people who feel streaming services cannot be trusted to be custodians of cultural artefacts like film.</span></li>
                <li><span class="highlight-fix">To show that streaming services are controlling access to the cultural commons rather than expanding it.</span></li>
                <li><span class="highlight-fix">To show how unsubstantiated reports are leading to an increase in the level of distrust towards streaming services.</span></li>
                <li><span class="highlight-fix">To show that art in the digital age, specifically film, is no longer sacrosanct, and...</span></li>
            </ol>
        </div>
    </div>
    
    <div class="test-section">
        <div class="test-title">Fix Applied</div>
        
        <div class="debug-info">
<strong>Root Cause:</strong>
The ordered list detection logic was flawed - it wasn't properly grouping consecutive numbered items into &lt;ol&gt; tags.

<strong>Solution:</strong>
1. Find all &lt;li&gt; elements in the processed HTML
2. Map them back to original markdown lines
3. Detect which lines start with numbers (1., 2., 3., etc.)
4. Group consecutive numbered items into &lt;ol&gt; tags
5. Group consecutive bullet items into &lt;ul&gt; tags

<strong>Key Changes:</strong>
- Improved list item position tracking
- Better original line mapping
- Proper consecutive list grouping
- Correct &lt;ol&gt; vs &lt;ul&gt; detection
        </div>
        
        <div class="after">
            <div class="after-label">Expected Result:</div>
            <ul>
                <li><strong>Correct numbering</strong> - 1, 2, 3, 4 instead of 1, 1, 1, 1</li>
                <li><strong>Proper HTML structure</strong> - &lt;ol&gt; tags wrapping numbered items</li>
                <li><strong>Clean content</strong> - Numbers removed from &lt;li&gt; content</li>
                <li><strong>Mixed lists</strong> - Handles both ordered and unordered lists</li>
            </ul>
        </div>
    </div>
    
    <div class="test-section">
        <div class="test-title">Testing Instructions</div>
        
        <div class="debug-info">
<strong>To Test:</strong>
1. Upload a PDF with multiple choice questions
2. Check that numbered options show as 1, 2, 3, 4
3. Verify bullet points still work correctly
4. Open browser console to see debug logs
5. Look for "Final ordered lists found" message

<strong>Console Output to Look For:</strong>
[ButtonPanel] Found list items: 4
[ButtonPanel] Final ordered lists found: 1
[ButtonPanel] First ordered list: &lt;ol&gt;&lt;li&gt;To show a practice...&lt;/li&gt;&lt;li&gt;To show that streaming...&lt;/li&gt;&lt;/ol&gt;
        </div>
        
        <div class="after">
            <div class="after-label">Success Criteria:</div>
            <ul>
                <li>✅ Options numbered correctly (1, 2, 3, 4)</li>
                <li>✅ No "1." prefix in the actual text</li>
                <li>✅ Proper HTML &lt;ol&gt; structure</li>
                <li>✅ Clean spacing and formatting</li>
            </ul>
        </div>
    </div>
    
    <script>
        // Test the ordered list processing
        const testContent = `Q.2 "Netflix had begun editing old episodes of Stranger Things to retroactively improve their visual effects." What is the purpose of this example used in the passage?
1. To show a practice that justifies the fears of people who feel streaming services cannot be trusted to be custodians of cultural artefacts like film.
2. To show that streaming services are controlling access to the cultural commons rather than expanding it.
3. To show how unsubstantiated reports are leading to an increase in the level of distrust towards streaming services.
4. To show that art in the digital age, specifically film, is no longer sacrosanct, and...`;
        
        console.log('Testing ordered list processing...');
        
        // Simulate the processing
        let html = testContent;
        
        // Convert ordered lists
        html = html.replace(/^[\s]*\d+\. (.+)$/gm, (match, content) => {
            const cleanedContent = content.trim().replace(/\s+/g, ' ');
            return `<li>${cleanedContent}</li>`;
        });
        
        console.log('[Test] After list item conversion:', html);
        
        // Find list items
        const listItems = html.match(/<li>.*?<\/li>/g) || [];
        console.log('[Test] Found list items:', listItems.length);
        
        // Check if they should be in ordered list
        const originalLines = testContent.split('\n');
        const hasOrderedItems = originalLines.some(line => /^\s*\d+\./.test(line));
        console.log('[Test] Has ordered items:', hasOrderedItems);
        
        if (hasOrderedItems && listItems.length > 0) {
            const listContent = listItems.join('');
            html = html.replace(listItems.join(''), `<ol>${listContent}</ol>`);
            console.log('[Test] Final HTML with ordered list:', html);
        }
    </script>
</body>
</html>
